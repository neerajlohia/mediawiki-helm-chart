# mediawiki-helm-chart
This repository has a helm chart for Mediawiki and a subchart for its dependency on MariaDB database. 

## Requirements
The charts were developed and tested on `Helm 3.1.0` and `Kubernetes 1.21.1` 

For now the Kubernetes pods rely on NFS storage to store data persistently. Two NFS mount points, as described below, must be set up for persistence storage and `values.yaml` files must be updated.
1. To store the `LocalSettings.php` file generated by the Mediawiki wizard after the application deployment.
2. To store database information of the MariaDB database.

Updates in the values.yaml file:
   * `pv.nfs.server` : IP or Hostname of the NFS server for Mediawiki.
   * `pv.nfs.path` : Mount point shared by the NFS server.
   * `mariadb.pv.nfs.server`: NFS server for MariaDB.
   * `mariadb.pv.nfs.path`: Mount point shared by the NFS server for MariaDB database

Already existing `LocalSettings.php` and database can also be used. 

## Installing the charts

Clone the repo:
```
git clone https://github.com/neerajlohia/mediawiki-helm-chart.git
```

#### If using for the first time and the database is not initialized:
Make sure to define the variables accordingly.
```BASH
export MARIADB_ROOT_PASSWORD="password";
export MEDIAWIKI_DATABASE_USER="wikiuser";
export MEDIAWIKI_DATABASE_PASSWORD="wikipass";
helm install my-mediawiki . --set mariadb.secret.root_password="$MARIADB_ROOT_PASSWORD" \
  --set mariadb.secret.username="$MEDIAWIKI_DATABASE_USER" \
  --set mariadb.secret.password="$MEDIAWIKI_DATABASE_PASSWORD"
```

#### Database, user already exist and is in place via the mount point for MariaDB
These values will not be used. But make sure to enter values to the following else you'll need to put them in the `helm` commands:
* mariadb.secret.root_password
* mariadb.secret.username
* mariadb.secret.password

#### In Action
![helm install](https://user-images.githubusercontent.com/10653698/119278523-7368a280-bc43-11eb-9b43-e67571144f5a.png)
---
![helm list](https://user-images.githubusercontent.com/10653698/119278555-a4e16e00-bc43-11eb-801b-16140cf5fb68.png)
---
![kubectl get all](https://user-images.githubusercontent.com/10653698/119278569-ba569800-bc43-11eb-8d02-bb930d3dd346.png)
---
![setup page](https://user-images.githubusercontent.com/10653698/119278627-13263080-bc44-11eb-9f88-0981f8ec5ac7.png)
---
![post installation](https://user-images.githubusercontent.com/10653698/119278874-b9266a80-bc45-11eb-8b7f-d6614b3dc021.png)

Download the `LocalSettings.php` file and place it on the NFS partition for Mediawiki then 'enter your wiki'.

---
![All done](https://user-images.githubusercontent.com/10653698/119278934-2803c380-bc46-11eb-9e4d-a4729f04cf40.png)

